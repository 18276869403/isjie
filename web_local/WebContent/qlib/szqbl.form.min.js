(function(win) {
	win.szqbl = win.szqbl || {};

	win.szqbl.bindForm = function(filter, url, isUploadImg, isUploadFile, submitBefore, submitAfter, errorFn) {

		if (isUploadImg) {
			//单张图上传
			$(".uploadImg").each(function() {
				var opid = $(this).attr("id");
				szqbl.bindUploadImage(opid, $("." + opid + "FKID").val(), 0, $("." + opid + "PATH").val() + new Date().format('/yyyyMMdd'));
			});

			//多张图上传
			$(".uploadImgs").each(function() {
				var opid = $(this).attr("id");
				szqbl.bindUploadImages(opid, $("." + opid + "FKID").val(), 0, $("." + opid + "PATH").val() + new Date().format('/yyyyMMdd'));
			});
		}

		if (isUploadFile) {

		}

		layui.form.on("submit(" + filter + ")", function(data) {
			//弹出loading
			var index = top.layer.msg('数据提交中，请稍候', {
				icon : 16,
				time : false,
				shade : 0.8
			});
			// 实际使用时的提交信息
			var postData = data.field;
			if (submitBefore) {
				var ret = submitBefore(postData);
				//还回false的时候不提交，方便方法可以自定义验证
				if (ret == false) {
					top.layer.close(index);
					return false;
				}
				postData = ret;
			}
			$.post(contextPath + url, postData, function(res) {
				top.layer.close(index);
				if (submitAfter) {
					submitAfter(res);
				} else {
					if (res.status == 200) {
						top.layer.msg(res.message);
						layer.closeAll("iframe");
						//刷新父页面
						parent.location.reload();
					}else{
						top.layer.msg(res.message);
					}
				}
			}).error(function(e){
				top.layer.close(index);
				if(errorFn){
					errorFn(e);
				}
			});
			return false;
		});
		$(".layui-btn-primary").click(function() {
			layer.closeAll("iframe");
			//刷新父页面
			parent.location.reload();
		});
	};
}(window));